# 0. プロダクト概要

* **目的**：学習コンテンツから自動で良質なクイズを生成し、忘却を抑えて定着率を上げる
* **主要KPI（MVP）**：

  * 7日継続率 ≥ 30%
  * 1日あたり出題消化数（中央値） ≥ 8問
  * 1ユーザーあたりカード編集率 ≤ 20%（=自動生成品質の目安）
* **スコープIN**：テキスト入力→クイズ自動生成→日次復習→成績可視化/CSV出力
* **スコープOUT（初期）**：協働編集、音声入出力、外部公開共有、SSO（メール+パスワードのみ）

# 1. ペルソナ & ユースケース（3本）

## 1-1 英単語学習（高校生・健太）

* **ニーズ**：単語暗記を高速に回す／苦手の可視化
* **完了の定義**：30語入力→30問以上生成→翌日、誤答語が優先出題

## 1-2 条文暗記（社会人・美咲）

* **ニーズ**：長文から要点抽出→穴埋め化／計画的復習
* **完了の定義**：条文から5問以上の単一正答cloze生成→SM-2でリスケ

## 1-3 社内研修（研修担当・佐藤）

* **ニーズ**：マニュアルを測れる形に→理解度の低い領域を特定
* **完了の定義**：10問以上自動生成（○×/四択/cloze混在）→受講者成績をCSV

# 2. 主要ユーザーストーリー & 受け入れ基準

## US-01 テキスト投入でクイズ生成

* **As** 学習者、**I want** ノート/条文/箇条書きを貼ると自動で問題化、**So that** すぐ学習を回せる
* **受け入れ基準**

  1. 300〜1,500文字から**最低5問**生成（英単語なら30語→30問以上）
  2. **単一正答率 60%以上**（曖昧語・多義語は候補提示）
  3. 生成≤5秒、編集UIで**削除/書き換え/選択肢追加**が可能

## US-02 日次復習キュー

* **As** 学習者、**I want** 今日やるべき10問が自動提示、**So that** 毎日迷わず進められる
* **受け入れ基準**

  1. `dueDate ≤ 今日` のカード最大10枚＋新規2〜3枚
  2. 1セッション10問、所要3〜6分
  3. セッション完了で連続記録・残件数が更新

## US-03 採点・解説・弱点タグ

* **受け入れ基準**

  1. 提出時に即時採点（四択/○×/cloze）
  2. 誤答時は**根拠ハイライト**（原文スニペット）表示
  3. タグ別正答率を算出し、**弱点トップ3**を提示

## US-04 研修配信＆集計（管理者）

* **受け入れ基準**

  1. 指定コースに問題セットを配信（リンク or 受講者紐付け）
  2. 受講完了率・平均正答率・設問難易度をダッシュボード表示
  3. **CSV出力**（受講者, 日付, 問ID, 正誤, 所要秒, タグ）

# 3. UXフロー / 主要画面

1. **ホーム**：今日の10問・連続日数・弱点タグ
2. **入力**：テキスト/語彙リスト貼付→生成→下書き一覧
3. **カード編集**：問/答/選択肢/タグ/根拠の編集、プレビュー
4. **クイズ実施**：1問ずつ、スキップ可、キーボード操作
5. **結果/解説**：スコア、誤答一覧、根拠スニペット、再挑戦
6. **管理（研修）**：セット作成→配信→受講状況→CSV

# 4. データモデル（最小ERD）

* **User**(id, name, email)
* **Note**(id, userId, rawText, sourceType\[manual/file/url], createdAt)
* **Card**(id, userId, noteId, type\[mcq/tf/cloze], prompt, answer, choices\[], tags\[], rationale, createdAt)
* **ReviewState**(userId, cardId, easiness(=EF), intervalDays, repetition, dueDate, lastResult\[0-5])
* **Quiz**(id, userId, createdAt)
* **QuizItem**(id, quizId, cardId, userAnswer, isCorrect, timeSec)
* **Assignment**(id, ownerUserId, title, cardIds\[], assigneeIds\[], dueOn)  ※研修用

### 例：Card JSON

```json
{
  "id": "c_123",
  "userId": "u_1",
  "noteId": "n_9",
  "type": "cloze",
  "prompt": "SM-2では学習カードの難易度を{{easiness}}という指標で管理する。",
  "answer": "easiness",
  "choices": [],
  "tags": ["記憶法","SM-2"],
  "rationale": "原文: 'The SM-2 algorithm uses an E-Factor (easiness) ...'",
  "createdAt": "2025-08-09T06:00:00Z"
}
```

# 5. アルゴリズム仕様（MVP）

## 5-1 自動問題生成（ヒューリスティック）

* **英単語**：改行/カンマ区切りを語彙としてMCQ化（**誤選択肢**は同リストの近似語/品詞一致）
* **条文**：固有名詞・数値・定義語をcloze候補に。1文1穴を原則、複数穴は2つまで
* **一般テキスト**：

  * 文頭定義（「〜とは」）→○×化（否定パターン自動生成）
  * 箇条書き（- / ・）→項目入替MCQ
* **品質ルール**：

  * 答え文字数 1–30／句読点含まない
  * cloze重複禁止／文脈スニペットをrationaleに保持
  * 同一ノート由来の**重複問を自動統合**

## 5-2 復習スケジューリング（SM-2準拠）

* `EF` 初期2.5、`interval` 1→6→`interval * EF`
* 解答評価`q`（0〜5）：

  * q<3 → repetition=0, interval=1, due=明日
  * q≥3 → EF=EF+(0.1-(5-q)\*(0.08+(5-q)\*0.02))（下限1.3）
* **日次出題**：`due ≤ today` 上位10 + 新規2〜3（新規はタグ分散）

# 6. API（想定）

* `POST /notes` … テキスト保存（返：noteId）
* `POST /cards/generate {noteId}` … 自動生成（返：Card\[]）
* `PATCH /cards/:id` … 編集（問/答/choices/tags/rationale）
* `GET /daily-quiz` … 今日の10問（返：Quiz, QuizItem\[]）
* `POST /submit-quiz {quizId, answers[]}` … 採点＋ReviewState更新
* `GET /stats/summary` … 連続日数、タグ別正答率、推奨学習時間
* 研修用：

  * `POST /assignments`（配信作成）
  * `GET /assignments/:id/results?format=csv`

# 7. 非機能要件（MVP）

* **パフォーマンス**：生成≤5秒、画面応答≤100ms（p95）
* **可用性**：月間SLO 99%
* **セキュリティ/プライバシー**：

  * ユーザーデータは論理分離、削除要求に72h以内対応
  * 研修データは管理者のみCSV取得可
* **ログ/計測**：正誤、所要時間、離脱箇所、編集率

# 8. 画面要素（要件抜粋）

* **入力画面**：貼付エリア（最大1.5万字）、言語/分野選択、プレビュー
* **編集画面**：カードリスト（並べ替え/タグ付け）、曖昧警告、重複検知
* **実施画面**：1問表示・スキップ、残数、タイマー、キーボード操作（1–4/Enter）
* **結果画面**：スコア、誤答一覧、根拠、再挑戦、弱点タグTop3
* **研修改善**：設問難度（正答率ベース）、講義別理解度ヒートマップ

# 9. CSV仕様（研修・エクスポート）

* ヘッダ：`userId, userName, date, quizId, cardId, tag, isCorrect, timeSec`
* 文字コード：UTF-8、改行LF
* 行数上限：10万行/ダウンロード

# 10. テスト観点（サンプル）

* **単体**：

  * 生成：条文からclozeが5問以上／単一正答率≥60%
  * 採点：clozeの大文字小文字・全角半角ゆらぎを許容（正規化）
* **結合**：`submit-quiz`でReviewStateが更新・dueが未来に進む
* **E2E**：新規ユーザーが3分で「入力→生成→10問実施→結果→翌日復習」に到達

# 11. リリース計画

* **P0（2週間）**：入力→生成→編集→出題→採点（縦串）
* **P1**：SM-2復習・弱点タグダッシュボード
* **P2**：研修配信・CSV・難易度推定
* **リスク対策**：生成の誤り→“曖昧検知”と編集UI／採点ログから**NG例のルール化**
